@{
    try
    {
        var order = Request["Order Id"];
        var name = Request["Product Name"];
        var price = Request["Unit Price"];
        var quant = Request["Quantity"];
        var db = Database.Open("Orders");
        db.Execute(@"INSERT INTO Details ([Order Id], [Product Name], [Unit Price], [Quantity]) 
                VALUES (@0, @1, @2, @3)", order, name, price, quant);
        var detail = db.QuerySingle("SELECT * FROM Details WHERE [Detail Id] = @0",
                db.GetLastInsertId());
        var json = Json.Encode(new{Result = "OK", Record = detail});
        Response.Write(json);       
    }
    catch (Exception ex)
    {
        var json = Json.Encode(new{Result = "ERROR", Message = ex.Message});
        Response.Write(json);
    }
}
